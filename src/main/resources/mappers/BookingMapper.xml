<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bowling.mapper.BookingMapper">


	<insert id="bookingRegister">
		INSERT INTO booking
		(ALLEY_SEQ, MEMBER_ID, BO_TIME, BO_DATE, BO_GAME, PUBLIC_CNT, CLUB_CNT, STUDENT_CNT, FIRST_REGIST_TM, FIRST_REGIST_ID, LAST_UPDT_TM)
		VALUES (#{alleySeq}, #{memberId}, #{boTime}, #{boDate}, #{boGame}, #{publicCnt}, #{clubCnt}, #{studentCnt}, NOW(), #{memberId}, NOW())
	</insert>
	
	<insert id="alley_grade_register">
		INSERT INTO alley_member_grade (ALLEY_SEQ, MEMBER_ID, ALLEY_MEMBER_GRADE, ALLEY_NAME)
		VALUES (#{alleySeq}, #{memberId}, '일반', #{alleyName})
	</insert>
	
	<select id="alley_grade_select" resultType="String">
		SELECT ALLEY_MEMBER_GRADE FROM alley_member_grade WHERE member_id = #{memberId} AND alley_seq = #{alleySeq}
	</select>




	<select id="bookingDetail" resultType="java.util.Map">
		SELECT *
		FROM 
		( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t09 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '09:00' AND BO_DATE = #{boDate} ) t09
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t10 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '10:00' AND BO_DATE = #{boDate} ) t10
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t11 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '11:00' AND BO_DATE = #{boDate} ) t11
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t12 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '12:00' AND BO_DATE = #{boDate} ) t12
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t13 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '13:00' AND BO_DATE = #{boDate} ) t13
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t14 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '14:00' AND BO_DATE = #{boDate} ) t14
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t15 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '15:00' AND BO_DATE = #{boDate} ) t15
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t16 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '16:00' AND BO_DATE = #{boDate} ) t16
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t17 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '17:00' AND BO_DATE = #{boDate} ) t17
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t18 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '18:00' AND BO_DATE = #{boDate} ) t18
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t19 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '19:00' AND BO_DATE = #{boDate} ) t19
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t20 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '20:00' AND BO_DATE = #{boDate} ) t20
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t21 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '21:00' AND BO_DATE = #{boDate} ) t21
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t22 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '22:00' AND BO_DATE = #{boDate} ) t22
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t23 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '23:00' AND BO_DATE = #{boDate} ) t23
		,( SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t24 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = '24:00' AND BO_DATE = #{boDate} ) t24
	</select>
	
	<select id="bookingDetailOne" resultType="Integer">
		SELECT sum(PUBLIC_CNT+ CLUB_CNT+ STUDENT_CNT) AS t09 FROM booking WHERE ALLEY_SEQ = #{alleySeq} AND BO_TIME = #{boTime} AND BO_DATE = #{boDate}
	</select>


	<delete id="bookingDelete">
		DELETE FROM BOOKING WHERE BO_NUM = #{boNum}
	</delete>

	<select id="selectBooking" resultMap="BookingVO">
		SELECT BO_NUM,ALLEY_SEQ,BO_TIME,BO_DATE,MEMBER_ID
		FROM BOOKING
		WHERE ALLEY_SEQ = #{alleySeq} AND BO_DATE = #{boDate}  
		<if test='!memberId.equals("admin")'>
			AND MEMBER_ID = #{memberId}
		</if>
	</select>




<resultMap id="BookingVO" type="com.bowling.domain.vo.BookingVO">
      <result property="alleySeq" column="ALLEY_SEQ" />
      <result property="boNum" column="BO_NUM" />
      <result property="boTime" column="BO_TIME" />
      <result property="boDate" column="BO_DATE" />
      <result property="memberId" column="MEMBER_ID" />
   </resultMap>


</mapper>